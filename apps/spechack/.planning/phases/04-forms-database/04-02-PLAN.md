---
phase: 04-forms-database
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - apps/spechack/src/app/[locale]/_components/RegistrationForm.tsx
  - apps/spechack/src/app/[locale]/_components/AmbassadorForm.tsx
  - apps/spechack/src/app/[locale]/_components/Hero.tsx
  - apps/spechack/src/app/[locale]/_components/Hubs.tsx
autonomous: true
must_haves:
  truths:
    - "User can fill out registration form and submit it to create a database record"
    - "User sees agent number on successful registration"
    - "User with duplicate email sees existing card data returned"
    - "User sees validation errors for invalid form input"
    - "User can expand ambassador form in Hubs section and submit application"
    - "User sees success confirmation after ambassador submission"
  artifacts:
    - path: "apps/spechack/src/app/[locale]/_components/RegistrationForm.tsx"
      provides: "Client form component with useActionState binding to submitRegistration"
      min_lines: 80
    - path: "apps/spechack/src/app/[locale]/_components/AmbassadorForm.tsx"
      provides: "Client form component with expandable UI and useActionState binding"
      min_lines: 60
    - path: "apps/spechack/src/app/[locale]/_components/Hero.tsx"
      provides: "Server component passing translations and locale to RegistrationForm"
      contains: "RegistrationForm"
    - path: "apps/spechack/src/app/[locale]/_components/Hubs.tsx"
      provides: "Server component passing translations and locale to AmbassadorForm"
      contains: "AmbassadorForm"
  key_links:
    - from: "apps/spechack/src/app/[locale]/_components/RegistrationForm.tsx"
      to: "apps/spechack/src/app/[locale]/_actions/register.actions.ts"
      via: "useActionState(submitRegistration, null)"
      pattern: "useActionState.*submitRegistration"
    - from: "apps/spechack/src/app/[locale]/_components/AmbassadorForm.tsx"
      to: "apps/spechack/src/app/[locale]/_actions/ambassador.actions.ts"
      via: "useActionState(submitAmbassador, null)"
      pattern: "useActionState.*submitAmbassador"
    - from: "apps/spechack/src/app/[locale]/_components/Hero.tsx"
      to: "apps/spechack/src/app/[locale]/_components/RegistrationForm.tsx"
      via: "translation prop-drilling"
      pattern: "<RegistrationForm"
    - from: "apps/spechack/src/app/[locale]/_components/Hubs.tsx"
      to: "apps/spechack/src/app/[locale]/_components/AmbassadorForm.tsx"
      via: "translation prop-drilling"
      pattern: "<AmbassadorForm"
---

<objective>
Create client form components for registration and ambassador applications, wired to Server Actions via useActionState.

Purpose: Transform the presentational Hero form and Hubs CTA button into functional, database-connected forms with validation error display and success states.
Output: Two client form components (RegistrationForm, AmbassadorForm), two updated server components (Hero, Hubs).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-forms-database/04-RESEARCH.md
@.planning/phases/04-forms-database/04-01-SUMMARY.md

@apps/spechack/src/app/[locale]/_components/Hero.tsx
@apps/spechack/src/app/[locale]/_components/HeroContent.tsx
@apps/spechack/src/app/[locale]/_components/Hubs.tsx
@apps/spechack/src/app/[locale]/page.tsx
@apps/spechack/messages/es.json
@apps/spechack/messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RegistrationForm client component and update Hero</name>
  <files>
    apps/spechack/src/app/[locale]/_components/RegistrationForm.tsx
    apps/spechack/src/app/[locale]/_components/Hero.tsx
  </files>
  <action>
  **A) Create `RegistrationForm.tsx`** -- "use client" component.

  Imports:
  - `useActionState` and `useState` from `"react"`
  - `submitRegistration` and `type RegisterFormState` from `"../_actions/register.actions"`

  **Props type:**
  ```typescript
  type RegistrationFormProps = {
    locale: "es" | "en";
    translations: {
      formTitle: string;
      formName: string;
      formEmail: string;
      formCity: string;
      trackVirtual: string;
      trackHub: string;
      trackVirtualHelper: string;
      trackHubHelper: string;
      submit: string;
      formNote: string;
      successTitle: string;
      successSub: string;
    };
  };
  ```

  **Component logic:**
  - `const [state, formAction, isPending] = useActionState(submitRegistration, null);`
  - `const [track, setTrack] = useState<"virtual" | "hub">("virtual");`

  **Success state:** When `state?.success === true`, render a success card showing:
  - `translations.successTitle` as heading
  - Agent number: `state.data?.agentNumber` in large mono font with primary color
  - `translations.successSub` as subtext
  - Note: Phase 5 will replace this with the full CardReveal animation component

  **Form state (default):** Render a `<form action={formAction}>` containing:
  - Hidden input: `<input type="hidden" name="locale" value={locale} />`
  - Hidden input: `<input type="hidden" name="track" value={track} />`
  - Name input field with label, `name="name"`, `required` attribute
  - Email input field with label, `name="email"`, `type="email"`, `required`
  - City input field with label, `name="city"`, `required`
  - Track toggle: Two buttons that toggle `track` state. Active button gets `bg-background border border-border` classes, inactive gets `bg-transparent border border-transparent text-muted-foreground`. Show helper text below based on selected track: `translations.trackVirtualHelper` or `translations.trackHubHelper`.
  - Submit button: `disabled={isPending}`, shows `"..."` text when pending, else `translations.submit`
  - Form note: `translations.formNote`

  **Validation errors:** Below each input, conditionally render `state?.errors?.{fieldName}` as red text:
  ```tsx
  {state?.errors?.name && (
    <p className="text-red-400 text-xs font-mono">{state.errors.name[0]}</p>
  )}
  ```

  **Styling:** Preserve the exact same Tailwind classes from the current Hero.tsx form markup:
  - Card wrapper: `bg-card border border-border rounded-lg p-6 sm:p-8 space-y-6`
  - Labels: `block font-mono text-xs text-muted-foreground uppercase tracking-wider`
  - Inputs: `w-full bg-muted border border-border rounded-md px-4 py-2.5 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-primary`
  - Submit: `w-full bg-primary text-primary-foreground font-mono text-sm px-6 py-3 rounded-md hover:opacity-90 transition-opacity disabled:opacity-50`

  **B) Update `Hero.tsx`** -- replace form markup with RegistrationForm component.

  - Add import for `RegistrationForm`
  - The Hero component already calls `getTranslations("hero")`
  - Need to get locale: add `import { getLocale } from "next-intl/server"` and `const locale = await getLocale() as "es" | "en"`
  - Replace the entire right-side `<div className="bg-card...">...</div>` with:
    ```tsx
    <RegistrationForm
      locale={locale}
      translations={{
        formTitle: t("formTitle"),
        formName: t("formName"),
        formEmail: t("formEmail"),
        formCity: t("formCity"),
        trackVirtual: t("trackVirtual"),
        trackHub: t("trackHub"),
        trackVirtualHelper: t("trackVirtualHelper"),
        trackHubHelper: t("trackHubHelper"),
        submit: t("submit"),
        formNote: t("formNote"),
        successTitle: t("successTitle"),
        successSub: t("successSub"),
      }}
    />
    ```
  - Keep the left-side content (headline, date, etc.) exactly as-is
  - Keep the `<section>` wrapper, radial gradients, and `<HeroContent>` structure as-is
  </action>
  <verify>
  1. `bun run build` compiles without errors
  2. `bun run check` passes Biome lint
  3. Hero.tsx no longer contains form markup directly -- it renders `<RegistrationForm />`
  4. RegistrationForm.tsx has "use client" directive, useActionState binding, hidden locale/track fields
  5. Track toggle correctly switches between virtual/hub with visual feedback
  6. Validation errors display below each field
  7. Success state shows agent number
  </verify>
  <done>
  - RegistrationForm.tsx renders form with name/email/city/track fields, submits via useActionState
  - Hero.tsx passes locale + 12 translation strings to RegistrationForm
  - Form shows validation errors per-field and success state with agent number
  - All existing Hero visual design preserved
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AmbassadorForm client component and update Hubs</name>
  <files>
    apps/spechack/src/app/[locale]/_components/AmbassadorForm.tsx
    apps/spechack/src/app/[locale]/_components/Hubs.tsx
  </files>
  <action>
  **A) Create `AmbassadorForm.tsx`** -- "use client" component with expandable form.

  Imports:
  - `useActionState` and `useState` from `"react"`
  - `submitAmbassador` and `type AmbassadorFormState` from `"../_actions/ambassador.actions"`

  **Props type:**
  ```typescript
  type AmbassadorFormProps = {
    locale: "es" | "en";
    translations: {
      applyCta: string;
      formName: string;
      formEmail: string;
      formCity: string;
      formCommunity: string;
      formSubmit: string;
      formSuccess: string;
    };
  };
  ```

  **Component logic:**
  - `const [state, formAction, isPending] = useActionState(submitAmbassador, null);`
  - `const [isExpanded, setIsExpanded] = useState(false);`

  **Three states:**

  1. **Collapsed (default):** Show a button with `translations.applyCta` text. On click, `setIsExpanded(true)`. Style same as current Hubs CTA button: `bg-primary text-primary-foreground font-mono px-6 py-3 rounded-md hover:bg-primary/90 transition-colors`.

  2. **Expanded form:** When `isExpanded && !state?.success`, show `<form action={formAction}>`:
     - Hidden input: `<input type="hidden" name="locale" value={locale} />`
     - Name input: `name="name"`, `required`
     - Email input: `name="email"`, `type="email"`, `required`
     - City input: `name="city"`, `required`
     - Community textarea: `name="community"`, `required`, `rows={3}`, placeholder from `translations.formCommunity`
     - Submit button: `disabled={isPending}`, shows `"..."` when pending, else `translations.formSubmit`
     - Validation errors below each field (same pattern as RegistrationForm)

  3. **Success state:** When `state?.success`, show `translations.formSuccess` in a green-tinted confirmation message with a checkmark.

  **Styling for form fields:** Use same input styling as RegistrationForm:
  - Labels: `block font-mono text-xs text-muted-foreground uppercase tracking-wider`
  - Inputs: `w-full bg-muted border border-border rounded-md px-4 py-2.5 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-primary`
  - Textarea: Same classes as input but with `resize-none`
  - Form container: `space-y-4 mt-4`

  **B) Update `Hubs.tsx`** -- replace CTA button with AmbassadorForm.

  - Add import for `AmbassadorForm`
  - Get locale: `import { getLocale } from "next-intl/server"` and `const locale = await getLocale() as "es" | "en"`
  - Replace the `<button>` at the bottom with:
    ```tsx
    <AmbassadorForm
      locale={locale}
      translations={{
        applyCta: t("applyCta"),
        formName: t("formName"),
        formEmail: t("formEmail"),
        formCity: t("formCity"),
        formCommunity: t("formCommunity"),
        formSubmit: t("formSubmit"),
        formSuccess: t("formSuccess"),
      }}
    />
    ```
  - Keep all other Hubs content (title, traction text, city map, ambassador pitch) exactly as-is
  </action>
  <verify>
  1. `bun run build` compiles without errors
  2. `bun run check` passes Biome lint
  3. Hubs.tsx renders `<AmbassadorForm />` instead of the plain CTA button
  4. AmbassadorForm.tsx has "use client" directive, expand/collapse state, useActionState binding
  5. Community field is a textarea (not input), with `name="community"`
  6. Hidden locale field is present
  7. Success state shows confirmation message
  </verify>
  <done>
  - AmbassadorForm.tsx starts collapsed as CTA button, expands to show form on click
  - Form has name/email/city/community fields, submits via useActionState to ambassador Server Action
  - Hubs.tsx passes locale + 7 translation strings to AmbassadorForm
  - Form shows per-field validation errors and success confirmation
  - All existing Hubs visual design preserved
  </done>
</task>

</tasks>

<verification>
1. `bun run build` compiles the full app without errors
2. `bun run check` passes Biome lint
3. `bun run dev` -- registration form submits and returns agent number
4. `bun run dev` -- duplicate email submission returns existing data
5. `bun run dev` -- ambassador CTA button expands to form, form submits successfully
6. Both forms show validation errors for empty/invalid fields
7. Both forms pass locale via hidden field
</verification>

<success_criteria>
- Registration form submits to Server Action and displays agent number on success (REG-01)
- Duplicate email shows existing card data (REG-03)
- Ambassador form expands from CTA, submits, shows confirmation (AMB-01)
- Validation errors display per-field for both forms
- Translation prop-drilling pattern maintained (server fetches, passes to client)
- No "use client" cascade -- Hero and Hubs remain server components
</success_criteria>

<output>
After completion, create `.planning/phases/04-forms-database/04-02-SUMMARY.md`
</output>
