---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/database/src/schema.ts
autonomous: true

must_haves:
  truths:
    - "Database schema includes spechack_participants table with name, email, locale, and timestamps"
    - "Database schema includes spechack_ambassadors table with name, email, university, motivation, status, locale, and timestamps"
    - "TypeScript types SpechackParticipant and SpechackAmbassador are exported and inferred from table definitions"
    - "Existing landing app tables (intentSubmissions) remain unchanged and functional"
  artifacts:
    - path: "packages/database/src/schema.ts"
      provides: "Extended schema with spechack tables, enums, and type exports"
      contains: "spechack_participants"
    - path: "packages/database/src/schema.ts"
      provides: "SpecHack-specific enums"
      contains: "spechack_locale"
  key_links:
    - from: "packages/database/src/schema.ts"
      to: "drizzle-orm/pg-core"
      via: "schema definition imports"
      pattern: "pgSchema.*404 Tech Found"
    - from: "packages/database/src/schema.ts"
      to: "spechackParticipants"
      via: "type inference export"
      pattern: "spechackParticipants\\.\\$inferSelect"
---

<objective>
Extend the shared @404tf/database schema with SpecHack-specific tables for participant registrations and ambassador applications.

Purpose: The shared database package is used by both the landing app and spechack app. Adding spechack tables here establishes the data model for registrations (Phase 4) and ensures TypeScript types are available project-wide. This is independent of the app UI setup and can run in parallel.

Output: `packages/database/src/schema.ts` extended with `spechack_participants` and `spechack_ambassadors` tables, associated enums with `spechack_` prefix, and exported TypeScript types.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SpecHack tables and enums to shared database schema</name>
  <files>packages/database/src/schema.ts</files>
  <action>
Extend the existing `packages/database/src/schema.ts` with SpecHack-specific tables. The file currently has:
- `schema` constant (pgSchema("404 Tech Found"))
- `intentEnum` and `localeEnum` (landing-prefixed)
- `intentSubmissions` table
- `IntentSubmission` and `NewIntentSubmission` types

Add the following AFTER the existing code, preserving all existing content unchanged:

**New enums (spechack_ prefix to avoid collision):**
- `spechackLocaleEnum`: `schema.enum("spechack_locale", ["es", "en"])`
- `spechackTrackEnum`: `schema.enum("spechack_track", ["web", "mobile", "ai", "iot", "open"])` - registration track choices
- `ambassadorStatusEnum`: `schema.enum("spechack_ambassador_status", ["pending", "approved", "rejected"])`

**New table: spechack_participants** (for hackathon registrations):
- `id`: uuid, defaultRandom, primaryKey
- `agentNumber`: integer("agent_number") - sequential agent number (will be assigned by server action, NOT auto-increment since we need formatted SPEC-XXXX)
- `name`: text, notNull
- `email`: text, notNull, unique (prevent duplicate registrations)
- `city`: text, notNull
- `track`: spechackTrackEnum, notNull
- `builderClass`: text("builder_class") - assigned deterministically from name hash (one of 6 classes)
- `locale`: spechackLocaleEnum, notNull
- `createdAt`: timestamp with timezone, defaultNow, notNull

Import `integer` and `unique` from `drizzle-orm/pg-core` (add to existing import). For the unique email constraint, use `.unique()` on the email column.

**New table: spechack_ambassadors** (for hub ambassador applications):
- `id`: uuid, defaultRandom, primaryKey
- `name`: text, notNull
- `email`: text, notNull
- `city`: text, notNull
- `university`: text, notNull
- `motivation`: text, notNull
- `status`: ambassadorStatusEnum, notNull, default "pending"
- `locale`: spechackLocaleEnum, notNull
- `createdAt`: timestamp with timezone, defaultNow, notNull

**Type exports** (add after existing type exports):
```typescript
export type SpechackParticipant = typeof spechackParticipants.$inferSelect;
export type NewSpechackParticipant = typeof spechackParticipants.$inferInsert;
export type SpechackAmbassador = typeof spechackAmbassadors.$inferSelect;
export type NewSpechackAmbassador = typeof spechackAmbassadors.$inferInsert;
```

IMPORTANT:
- Do NOT modify existing landing app tables or enums
- Use `spechack_` prefix on ALL new enum names to avoid namespace collision
- Table names use `spechack_` prefix for clarity
- The `agentNumber` field is nullable initially (assigned after insert via a separate update) - make it `.notNull()` only if you also add a default. Better: make it an integer that is NOT null but without a default, and note that the server action will compute and provide it on insert. Actually, simplest: make it nullable (no .notNull()) since it gets assigned right after insert. The server action in Phase 4 will handle this.
- Keep the `boolean` import in the existing imports if it's there (it's not currently, but the research showed it). Only import what's actually needed.
  </action>
  <verify>
1. Run `npx tsc --noEmit` from the packages/database/ directory (or `bun run tsc --noEmit` if available) to confirm TypeScript compiles without errors
2. Verify the file contains: spechack_participants table, spechack_ambassadors table, spechack_locale enum, spechack_track enum, spechack_ambassador_status enum
3. Verify existing intentSubmissions table and types are unchanged
4. Verify all 4 new type exports exist (SpechackParticipant, NewSpechackParticipant, SpechackAmbassador, NewSpechackAmbassador)
5. Verify email column on spechack_participants has .unique() constraint
  </verify>
  <done>The shared database schema includes spechack_participants and spechack_ambassadors tables with correct columns, spechack-prefixed enums, unique email constraint on participants, and exported TypeScript types. Existing landing tables are untouched. TypeScript compiles without errors.</done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds for packages/database
2. `packages/database/src/schema.ts` exports: spechackParticipants, spechackAmbassadors, SpechackParticipant, NewSpechackParticipant, SpechackAmbassador, NewSpechackAmbassador
3. Existing exports still work: intentSubmissions, IntentSubmission, NewIntentSubmission
4. No namespace collisions between landing and spechack enums
</verification>

<success_criteria>
- FOUND-05 SATISFIED: Shared database package extended with spechack_ prefixed tables for registrations and ambassador applications
- TypeScript types auto-generated by Drizzle $inferSelect/$inferInsert
- Existing landing app schema remains functional
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
