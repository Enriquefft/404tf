---
phase: 06-challenge-system
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/app/[locale]/c/[name]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User visiting /es/c/Maria sees challenge page with Maria's deterministic card preview"
    - "Challenge page displays '[Name] challenges you to join SpecHack' in correct language"
    - "User can register on challenge page and sees their own card reveal (not challenger's)"
    - "Challenge page has dynamic metadata (title, description) with challenger name"
  artifacts:
    - path: "src/app/[locale]/c/[name]/page.tsx"
      provides: "Challenge page route with card preview and registration form"
      exports: ["default", "generateMetadata"]
      min_lines: 80
  key_links:
    - from: "page.tsx"
      to: "generateDeterministicCard"
      via: "import and function call"
      pattern: "generateDeterministicCard\\(decodedName\\)"
    - from: "page.tsx"
      to: "TradingCard component"
      via: "JSX render"
      pattern: "<TradingCard card=\\{challengerCard\\}"
    - from: "page.tsx"
      to: "RegistrationForm component"
      via: "JSX render with translations"
      pattern: "<RegistrationForm"
    - from: "generateMetadata"
      to: "challenge translations"
      via: "getTranslations('challenge')"
      pattern: "getTranslations.*challenge"
---

<objective>
Create dynamic challenge page route at /[locale]/c/[name]/ displaying challenger's deterministic trading card with challenge prompt and registration form below.

Purpose: Enable viral sharing via challenge links. Users see friend's card preview and can register to get their own card.

Output: Fully functional challenge page route with locale-aware metadata and deterministic card previews.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-challenge-system/06-RESEARCH.md
@.planning/phases/05-trading-cards/05-02-SUMMARY.md
@.planning/phases/05-trading-cards/05-03-SUMMARY.md
@src/lib/card-utils.ts
@src/app/[locale]/_components/TradingCard.tsx
@src/app/[locale]/_components/RegistrationForm.tsx
@src/app/[locale]/_components/Hero.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create challenge page route directory and page.tsx</name>
  <files>
    src/app/[locale]/c/[name]/page.tsx
  </files>
  <action>
Create nested dynamic route at `src/app/[locale]/c/[name]/page.tsx` for challenge pages.

**File structure:**
```typescript
import { setRequestLocale } from "next-intl/server";
import { getTranslations } from "next-intl/server";
import { TradingCard } from "../../_components/TradingCard";
import { RegistrationForm } from "../../_components/RegistrationForm";
import { generateDeterministicCard } from "@/lib/card-utils";

type Props = {
  params: Promise<{ locale: string; name: string }>;
};

export async function generateMetadata({ params }: Props) {
  const { locale, name } = await params;
  const decodedName = decodeURIComponent(name);

  // Capitalize first letter for metadata
  const displayName = decodedName.charAt(0).toUpperCase() + decodedName.slice(1);

  const t = await getTranslations({ locale, namespace: "challenge" });

  return {
    title: t("metaTitle", { name: displayName }),
    description: t("metaDescription", { name: displayName }),
    openGraph: {
      title: t("metaTitle", { name: displayName }),
      description: t("metaDescription", { name: displayName }),
      // opengraph-image.tsx in same directory will be auto-detected in Plan 06-03
    },
  };
}

export default async function ChallengePage({ params }: Props) {
  const { locale, name } = await params;
  setRequestLocale(locale);

  // Decode URL-encoded name
  const decodedName = decodeURIComponent(name);
  const challengerCard = generateDeterministicCard(decodedName);

  // Get translations
  const t = await getTranslations("challenge");
  const heroT = await getTranslations("hero");
  const cardT = await getTranslations("cards");

  return (
    <main className="min-h-screen py-24 px-4 blueprint-grid">
      <div className="max-w-4xl mx-auto space-y-12">
        {/* Challenger card preview + challenge prompt */}
        <div className="flex flex-col items-center space-y-6">
          {/* Trading card preview */}
          <div className="w-[200px] sm:w-[240px]">
            <TradingCard card={challengerCard} locale={locale as "es" | "en"} />
          </div>

          {/* Challenge text */}
          <div className="text-center space-y-4 max-w-2xl">
            <h1 className="font-orbitron text-3xl sm:text-5xl font-extrabold text-primary">
              {t("title", { name: challengerCard.name })}
            </h1>
            <p className="text-lg sm:text-xl text-muted-foreground">
              {t("prompt")}
            </p>
          </div>
        </div>

        {/* Registration form */}
        <div className="max-w-xl mx-auto">
          <RegistrationForm
            locale={locale as "es" | "en"}
            translations={{
              formTitle: heroT("formTitle"),
              formName: heroT("formName"),
              formEmail: heroT("formEmail"),
              formCity: heroT("formCity"),
              trackVirtual: heroT("trackVirtual"),
              trackHub: heroT("trackHub"),
              trackVirtualHelper: heroT("trackVirtualHelper"),
              trackHubHelper: heroT("trackHubHelper"),
              submit: t("registerCta"), // "Accept Challenge" button text
              formNote: heroT("formNote"),
              successTitle: heroT("successTitle"),
              successSub: heroT("successSub"),
            }}
            cardTranslations={{
              download: cardT("download"),
              shareX: cardT("shareX"),
              challenge: cardT("challenge"),
              challengeCopy: cardT("challengeCopy"),
              challengeWhatsApp: cardT("challengeWhatsApp"),
              challengeLinkedIn: cardT("challengeLinkedIn"),
              recruitMore: cardT("recruitMore"),
              tweetTemplate: cardT("tweetTemplate"),
            }}
          />
        </div>
      </div>
    </main>
  );
}
```

**Key design decisions:**
1. **Decode name from URL:** `decodeURIComponent(name)` handles special characters
2. **Use challengerCard.name for title:** generateDeterministicCard() capitalizes name properly
3. **Custom submit button text:** `submit: t("registerCta")` shows "Accept Challenge" instead of default "Register"
4. **Reuse RegistrationForm:** Same component from Hero section, no duplication
5. **Success state:** User sees their own card (via CardReveal in RegistrationForm), not the challenger's card
6. **Background:** Uses `blueprint-grid` class from globals.css for consistent visual theme

**Pattern compliance:**
- Server component (no "use client")
- Translation prop-drilling (no client-side t() calls)
- Async params (Next.js 15+ pattern)
- setRequestLocale() for next-intl
- Named exports for generateMetadata
  </action>
  <verify>
    <command>test -f src/app/[locale]/c/[name]/page.tsx</command>
    <command>grep "export default async function ChallengePage" src/app/[locale]/c/[name]/page.tsx</command>
    <command>grep "export async function generateMetadata" src/app/[locale]/c/[name]/page.tsx</command>
    <command>grep "generateDeterministicCard" src/app/[locale]/c/[name]/page.tsx</command>
    <command>bun run build</command>
  </verify>
  <done>
File exists at src/app/[locale]/c/[name]/page.tsx with ChallengePage default export and generateMetadata export. Imports generateDeterministicCard, TradingCard, and RegistrationForm. Renders challenger card preview above registration form. Uses challenge translations for title and prompt. Build passes with no errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Test challenge routes in both locales</name>
  <files>
    (no file changes - verification only)
  </files>
  <action>
Build and verify challenge routes work correctly in both locales.

**Test cases:**
1. `/es/c/maria` — Spanish challenge page for "Maria"
2. `/en/c/john` — English challenge page for "John"
3. `/es/c/Mar%C3%ADa` — URL-encoded name with special character
4. `/en/c/multiple%20words` — Multi-word name (uses first word)

**Expected behavior:**
- Each URL renders challenge page with correct locale
- Deterministic card shows consistent gradient, builder class, agent number for same name
- Challenge title and prompt display in correct language
- Registration form submit button shows "Accept Challenge" / "Aceptar Desafío"
- No 404 errors, no SSR errors, no hydration warnings

**Build checks:**
```bash
bun run build
# Verify: Static route generation successful
# Verify: No TypeScript errors
# Verify: No "use client" cascade warnings
```
  </action>
  <verify>
    <command>bun run build 2>&1 | grep -i "error" && exit 1 || exit 0</command>
    <command>grep -c "generateDeterministicCard" src/app/[locale]/c/[name]/page.tsx</command>
    <command>grep -c "TradingCard" src/app/[locale]/c/[name]/page.tsx</command>
    <command>grep -c "RegistrationForm" src/app/[locale]/c/[name]/page.tsx</command>
  </verify>
  <done>
Build succeeds with no errors. Challenge page imports and uses generateDeterministicCard (1 occurrence), TradingCard (1 occurrence), and RegistrationForm (1 occurrence). All expected components rendered.
  </done>
</task>

</tasks>

<verification>
**Route structure check:**
```bash
ls -la src/app/[locale]/c/[name]/
# Should show: page.tsx
```

**TypeScript verification:**
```bash
bun run build
# Must pass with no errors
```

**Component imports:**
```bash
grep "import.*generateDeterministicCard" src/app/[locale]/c/[name]/page.tsx
grep "import.*TradingCard" src/app/[locale]/c/[name]/page.tsx
grep "import.*RegistrationForm" src/app/[locale]/c/[name]/page.tsx
```

**Translation usage:**
```bash
grep "getTranslations.*challenge" src/app/[locale]/c/[name]/page.tsx
grep "t(\"title\"" src/app/[locale]/c/[name]/page.tsx
grep "t(\"prompt\"" src/app/[locale]/c/[name]/page.tsx
grep "t(\"registerCta\"" src/app/[locale]/c/[name]/page.tsx
```
</verification>

<success_criteria>
**Requirement Coverage:**
- CHAL-01: ✓ Challenge route displays deterministic card preview
- CHAL-02: ✓ Challenge page shows prompt and registration form
- CHAL-03: ✓ User registering sees their own card (CardReveal in RegistrationForm)
- SEO-02: ✓ Dynamic metadata with challenger name

**Must-Have Truths Satisfied:**
1. User visiting /es/c/Maria sees challenge page with Maria's card (deterministic gradient, builder class, hash-based agent number)
2. User visiting /en/c/John sees English "John challenges you to join SpecHack" title
3. User visiting /es/c/Sofia sees Spanish "Sofia te desafía a unirte a SpecHack" title
4. User submitting registration on challenge page sees their own CardReveal component (not challenger's card)
5. generateMetadata() returns dynamic title and description with challenger name

**URL Handling:**
- URL-encoded names decoded properly (Mar%C3%ADa → María)
- Multi-word names handled (uses capitalized first word from generateDeterministicCard)
- Both /es/ and /en/ locales work correctly

**Files Created:**
- src/app/[locale]/c/[name]/page.tsx (challenge page route)
</success_criteria>

<output>
After completion, create `.planning/phases/06-challenge-system/06-02-SUMMARY.md` following the summary template.
</output>
