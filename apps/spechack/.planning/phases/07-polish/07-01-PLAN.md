---
phase: 07-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[locale]/_components/Toast.tsx
  - src/app/[locale]/c/[name]/loading.tsx
  - src/app/[locale]/c/[name]/error.tsx
  - messages/es.json
  - messages/en.json
autonomous: true

must_haves:
  truths:
    - "Toast component renders floating notifications with auto-dismiss"
    - "Challenge page shows pulsing shimmer skeleton during loading"
    - "Challenge page shows error boundary with retry button on failure"
    - "Error and loading translations exist in both locales"
  artifacts:
    - path: "src/app/[locale]/_components/Toast.tsx"
      provides: "Lightweight toast notification component"
      exports: ["Toast", "useToast"]
      min_lines: 40
    - path: "src/app/[locale]/c/[name]/loading.tsx"
      provides: "Challenge page loading skeleton"
      exports: ["default"]
      min_lines: 15
    - path: "src/app/[locale]/c/[name]/error.tsx"
      provides: "Challenge page error boundary"
      exports: ["default"]
      min_lines: 20
  key_links:
    - from: "Toast.tsx"
      to: "framer-motion"
      via: "AnimatePresence for enter/exit"
      pattern: "AnimatePresence"
    - from: "error.tsx"
      to: "translations"
      via: "error namespace"
      pattern: "error"
---

<objective>
Create toast notification infrastructure, challenge page loading skeleton, and challenge page error boundary. These are foundational UI pieces that Plan 07-02 depends on for form error display.

Purpose: Enable user-visible feedback for server errors (toast), smooth loading experience (skeleton), and graceful failure recovery (error boundary).

Output: Toast component with useToast hook, challenge page loading.tsx and error.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-polish/07-CONTEXT.md
@.planning/phases/07-polish/07-RESEARCH.md
@src/app/[locale]/c/[name]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Toast notification component</name>
  <files>
    src/app/[locale]/_components/Toast.tsx
  </files>
  <action>
Create a lightweight toast notification component at `src/app/[locale]/_components/Toast.tsx`.

**Requirements (from CONTEXT.md):**
- Floating toast for server/network errors
- Matches dark blueprint theme
- Auto-dismiss after ~4 seconds
- No external library dependency

**Component design:**

```typescript
"use client";

import { AnimatePresence, motion } from "framer-motion";
import { X } from "lucide-react";
import { createContext, useCallback, useContext, useState } from "react";

type ToastType = "error" | "success" | "info";

type Toast = {
  id: string;
  message: string;
  type: ToastType;
};

type ToastContextType = {
  showToast: (message: string, type?: ToastType) => void;
};

const ToastContext = createContext<ToastContextType | null>(null);

export function useToast() {
  const context = useContext(ToastContext);
  if (!context) throw new Error("useToast must be used within ToastProvider");
  return context;
}

export function ToastProvider({ children }: { children: React.ReactNode }) {
  const [toasts, setToasts] = useState<Toast[]>([]);

  const showToast = useCallback((message: string, type: ToastType = "error") => {
    const id = crypto.randomUUID();
    setToasts((prev) => [...prev, { id, message, type }]);
    setTimeout(() => {
      setToasts((prev) => prev.filter((t) => t.id !== id));
    }, 4000);
  }, []);

  const dismiss = useCallback((id: string) => {
    setToasts((prev) => prev.filter((t) => t.id !== id));
  }, []);

  return (
    <ToastContext.Provider value={{ showToast }}>
      {children}
      <div className="fixed top-4 right-4 z-50 flex flex-col gap-2">
        <AnimatePresence>
          {toasts.map((toast) => (
            <motion.div
              key={toast.id}
              initial={{ opacity: 0, y: -20, scale: 0.95 }}
              animate={{ opacity: 1, y: 0, scale: 1 }}
              exit={{ opacity: 0, y: -20, scale: 0.95 }}
              className={`flex items-center gap-3 rounded-lg border px-4 py-3 font-mono text-sm shadow-lg backdrop-blur-sm ${
                toast.type === "error"
                  ? "border-red-500/30 bg-red-950/80 text-red-200"
                  : toast.type === "success"
                    ? "border-emerald-500/30 bg-emerald-950/80 text-emerald-200"
                    : "border-cyan-500/30 bg-cyan-950/80 text-cyan-200"
              }`}
            >
              <span>{toast.message}</span>
              <button
                onClick={() => dismiss(toast.id)}
                className="ml-2 text-current opacity-60 hover:opacity-100"
              >
                <X size={14} />
              </button>
            </motion.div>
          ))}
        </AnimatePresence>
      </div>
    </ToastContext.Provider>
  );
}
```

**Key decisions:**
- Context-based `useToast` hook for any component to trigger toasts
- `ToastProvider` wraps the app (add to layout.tsx)
- AnimatePresence for smooth enter/exit animations
- Auto-dismiss at 4 seconds with manual dismiss option
- Dark theme colors matching blueprint aesthetic
- No external library — uses Framer Motion already in deps
- `"use client"` directive — toast is inherently interactive

**Integration point:**
Wrap app content in `<ToastProvider>` in `src/app/[locale]/layout.tsx`. This is a client component wrapping server content, which Next.js handles fine as a provider pattern.
  </action>
  <verify>
    <command>test -f 'src/app/[locale]/_components/Toast.tsx'</command>
    <command>grep "useToast" 'src/app/[locale]/_components/Toast.tsx'</command>
    <command>grep "ToastProvider" 'src/app/[locale]/_components/Toast.tsx'</command>
    <command>grep "AnimatePresence" 'src/app/[locale]/_components/Toast.tsx'</command>
  </verify>
  <done>
Toast.tsx exists with ToastProvider component, useToast hook, AnimatePresence animations, auto-dismiss, and dark theme styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add ToastProvider to layout and add translations</name>
  <files>
    src/app/[locale]/layout.tsx
    messages/es.json
    messages/en.json
  </files>
  <action>
**Step 1: Wrap layout with ToastProvider**

In `src/app/[locale]/layout.tsx`, import `ToastProvider` from `@/app/[locale]/_components/Toast` and wrap the children:

```tsx
import { ToastProvider } from "@/app/[locale]/_components/Toast";

// Inside the layout JSX, wrap children:
<ToastProvider>
  {children}
</ToastProvider>
```

**Step 2: Add error/loading/toast translations**

Add an `"errors"` namespace to both translation files:

**messages/es.json** — add:
```json
"errors": {
  "generic": "Algo salió mal. Intenta de nuevo.",
  "network": "Error de conexión. Verifica tu internet.",
  "registration": "No se pudo completar el registro. Intenta de nuevo.",
  "ambassador": "No se pudo enviar la solicitud. Intenta de nuevo.",
  "invalidChallenge": "Enlace de desafío inválido.",
  "retry": "Reintentar",
  "goHome": "Ir al inicio",
  "somethingWentWrong": "Algo salió mal"
}
```

**messages/en.json** — add:
```json
"errors": {
  "generic": "Something went wrong. Please try again.",
  "network": "Connection error. Check your internet.",
  "registration": "Registration failed. Please try again.",
  "ambassador": "Application failed. Please try again.",
  "invalidChallenge": "Invalid challenge link.",
  "retry": "Retry",
  "goHome": "Go home",
  "somethingWentWrong": "Something went wrong"
}
```

Also add ambassador success message to both:

**messages/es.json** (under existing "hubs" or new "ambassador" namespace):
```json
"ambassador": {
  "submitted": "¡Solicitud enviada!"
}
```

**messages/en.json:**
```json
"ambassador": {
  "submitted": "Application submitted!"
}
```
  </action>
  <verify>
    <command>grep "ToastProvider" 'src/app/[locale]/layout.tsx'</command>
    <command>grep "somethingWentWrong" messages/es.json</command>
    <command>grep "somethingWentWrong" messages/en.json</command>
    <command>grep "submitted" messages/es.json</command>
    <command>grep "submitted" messages/en.json</command>
  </verify>
  <done>
Layout wraps children with ToastProvider. Error translations exist in both ES and EN. Ambassador success translation added to both locales.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create challenge page loading.tsx skeleton</name>
  <files>
    src/app/[locale]/c/[name]/loading.tsx
  </files>
  <action>
Create `src/app/[locale]/c/[name]/loading.tsx` for the challenge page route.

**Requirements (from CONTEXT.md):**
- Pulsing shimmer skeleton matching dark blueprint theme
- Card-shaped placeholder + text shimmer
- Shows during client-side navigation to challenge pages

**Implementation:**
```tsx
export default function ChallengeLoading() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-center px-4 py-20">
      {/* Challenge header shimmer */}
      <div className="mb-8 flex flex-col items-center gap-4">
        <div className="h-8 w-64 animate-pulse rounded-lg bg-white/5" />
        <div className="h-6 w-48 animate-pulse rounded-lg bg-white/5" />
      </div>

      {/* Card shimmer */}
      <div className="h-[420px] w-[300px] animate-pulse rounded-2xl border border-white/5 bg-white/5" />

      {/* CTA shimmer */}
      <div className="mt-8 flex flex-col items-center gap-3">
        <div className="h-6 w-56 animate-pulse rounded-lg bg-white/5" />
        <div className="h-12 w-40 animate-pulse rounded-xl bg-white/5" />
      </div>
    </main>
  );
}
```

**Key points:**
- Server component (no "use client" needed)
- Uses Tailwind `animate-pulse` for shimmer effect
- `bg-white/5` matches the dark blueprint theme (subtle shimmer)
- Card placeholder matches approximate TradingCard dimensions
- No translations needed (it's a pure visual skeleton)
  </action>
  <verify>
    <command>test -f 'src/app/[locale]/c/[name]/loading.tsx'</command>
    <command>grep "animate-pulse" 'src/app/[locale]/c/[name]/loading.tsx'</command>
  </verify>
  <done>
loading.tsx exists with pulsing shimmer skeleton matching card dimensions and dark theme.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create challenge page error.tsx boundary</name>
  <files>
    src/app/[locale]/c/[name]/error.tsx
  </files>
  <action>
Create `src/app/[locale]/c/[name]/error.tsx` for the challenge page error boundary.

**Requirements (from CONTEXT.md):**
- "Something went wrong" message with retry button
- Targeted boundary (challenge page only)

**Implementation:**
```tsx
"use client";

import { useTranslations } from "next-intl";

type ErrorProps = {
  error: Error & { digest?: string };
  reset: () => void;
};

export default function ChallengeError({ error, reset }: ErrorProps) {
  const t = useTranslations("errors");

  return (
    <main className="flex min-h-screen flex-col items-center justify-center px-4 py-20">
      <div className="flex flex-col items-center gap-6 text-center">
        <div className="font-mono text-6xl text-red-500/40">!</div>
        <h1 className="font-orbitron text-2xl font-bold text-white">
          {t("somethingWentWrong")}
        </h1>
        <p className="max-w-md font-mono text-sm text-muted-foreground">
          {t("generic")}
        </p>
        <button
          onClick={reset}
          className="rounded-xl border border-cyan-500/30 bg-cyan-500/10 px-6 py-3 font-mono text-sm text-cyan-300 transition-colors hover:bg-cyan-500/20"
        >
          {t("retry")}
        </button>
      </div>
    </main>
  );
}
```

**Key decisions:**
- `"use client"` required for error.tsx (Next.js convention)
- Uses `useTranslations` (client component — next-intl handles this)
- `reset` function from Next.js re-renders the page segment
- Minimal, dark-themed UI with retry button
- Matches blueprint visual style
  </action>
  <verify>
    <command>test -f 'src/app/[locale]/c/[name]/error.tsx'</command>
    <command>grep '"use client"' 'src/app/[locale]/c/[name]/error.tsx'</command>
    <command>grep "reset" 'src/app/[locale]/c/[name]/error.tsx'</command>
  </verify>
  <done>
error.tsx exists with "use client" directive, error display, retry button, and translated strings.
  </done>
</task>

</tasks>

<verification>
**Toast component:**
```bash
grep "export function ToastProvider" 'src/app/[locale]/_components/Toast.tsx'
grep "export function useToast" 'src/app/[locale]/_components/Toast.tsx'
```

**Layout integration:**
```bash
grep "ToastProvider" 'src/app/[locale]/layout.tsx'
```

**Loading skeleton:**
```bash
test -f 'src/app/[locale]/c/[name]/loading.tsx'
```

**Error boundary:**
```bash
test -f 'src/app/[locale]/c/[name]/error.tsx'
grep "reset" 'src/app/[locale]/c/[name]/error.tsx'
```

**Translations:**
```bash
grep "errors" messages/es.json
grep "errors" messages/en.json
```

**Build:**
```bash
bun run build
```
</verification>

<success_criteria>
**Phase 7 Success Criteria Coverage:**
- SC-1 (partial): Challenge page has loading skeleton ✓
- SC-2: Error boundary with retry for challenge page ✓

**Must-Have Truths Satisfied:**
1. Toast component renders floating notifications with auto-dismiss
2. Challenge page shows pulsing shimmer skeleton during loading
3. Challenge page shows error boundary with retry button on failure
4. Error and loading translations exist in both locales

**Files Created:**
- src/app/[locale]/_components/Toast.tsx
- src/app/[locale]/c/[name]/loading.tsx
- src/app/[locale]/c/[name]/error.tsx

**Files Modified:**
- src/app/[locale]/layout.tsx (ToastProvider wrapper)
- messages/es.json (errors + ambassador namespace)
- messages/en.json (errors + ambassador namespace)
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish/07-01-SUMMARY.md` following the summary template.
</output>
