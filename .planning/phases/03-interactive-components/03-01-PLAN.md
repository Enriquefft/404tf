---
phase: 03-interactive-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/hooks/useScrollDirection.ts
  - src/hooks/useLocalStorage.ts
  - src/app/[locale]/_components/Navbar.tsx
  - src/app/[locale]/_components/AnnouncementBanner.tsx
  - src/app/[locale]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Navbar hides on scroll down and reappears on scroll up"
    - "Hamburger menu opens/closes on mobile (md: breakpoint)"
    - "Language switcher navigates between /es and /en preserving scroll position"
    - "AnnouncementBanner is dismissible via close button"
    - "Dismissed banner stays dismissed across page reloads (localStorage)"
    - "No hydration errors in browser console"
  artifacts:
    - path: "src/hooks/useScrollDirection.ts"
      provides: "Scroll direction detection hook"
      exports: ["useScrollDirection"]
    - path: "src/hooks/useLocalStorage.ts"
      provides: "SSR-safe localStorage persistence hook"
      exports: ["useLocalStorage"]
    - path: "src/app/[locale]/_components/Navbar.tsx"
      provides: "Interactive navbar with scroll, mobile menu, language switcher"
      contains: "use client"
    - path: "src/app/[locale]/_components/AnnouncementBanner.tsx"
      provides: "Dismissible announcement banner"
      contains: "use client"
  key_links:
    - from: "Navbar.tsx"
      to: "useScrollDirection"
      via: "import hook"
      pattern: "useScrollDirection"
    - from: "AnnouncementBanner.tsx"
      to: "useLocalStorage"
      via: "import hook"
      pattern: "useLocalStorage"
    - from: "page.tsx"
      to: "Navbar.tsx, AnnouncementBanner.tsx"
      via: "locale prop passing"
      pattern: "locale={locale}"
---

<objective>
Install Phase 3 dependencies, create custom hooks for scroll detection and localStorage persistence, and convert Navbar and AnnouncementBanner from static Server Components to interactive Client Components.

Purpose: Navbar and AnnouncementBanner are the first interactive elements users encounter. The navbar needs scroll-based show/hide, a mobile hamburger menu, and a working language switcher. The announcement banner needs dismiss persistence via localStorage.

Output: Two fully interactive Client Components (Navbar, AnnouncementBanner), two reusable custom hooks, and all Phase 3 npm dependencies installed.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-interactive-components/03-RESEARCH.md
@src/app/[locale]/_components/Navbar.tsx
@src/app/[locale]/_components/AnnouncementBanner.tsx
@src/app/[locale]/page.tsx
@messages/es.json
@messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create custom hooks</name>
  <files>
    package.json
    src/hooks/useScrollDirection.ts
    src/hooks/useLocalStorage.ts
  </files>
  <action>
    1. Install all Phase 3 dependencies:
       ```
       bun add framer-motion react-countup react-intersection-observer hamburger-react
       ```

    2. Create `src/hooks/` directory and `src/hooks/useScrollDirection.ts`:
       - "use client" directive at top
       - Track scroll direction ("up" | "down" | null)
       - Use passive scroll event listener for performance
       - 10px threshold to avoid jitter
       - Proper cleanup in useEffect return
       - Export `useScrollDirection` hook

    3. Create `src/hooks/useLocalStorage.ts`:
       - "use client" directive at top
       - Generic hook: `useLocalStorage<T>(key: string, initialValue: T): [T, (value: T) => void]`
       - Initialize state with `initialValue` (SSR-safe — no localStorage read during render)
       - Read from localStorage only in useEffect (after hydration)
       - setValue wrapper that updates both state and localStorage
       - Wrap localStorage access in try/catch
       - Key prefix convention: keys should use `404tf:` namespace (documented in JSDoc)

    Follow patterns from 03-RESEARCH.md Pattern 2 (scroll) and Code Examples section (useLocalStorage).
    Use tabs + double quotes (Biome convention).
  </action>
  <verify>
    - `bun install` exits 0 (no missing deps)
    - `bunx biome check src/hooks/` passes with zero errors
    - TypeScript: `bunx tsc --noEmit` passes (hooks have correct types)
  </verify>
  <done>
    All four Phase 3 deps installed. Two custom hooks exist with "use client" directives, proper SSR safety, and Biome-compliant formatting.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert Navbar and AnnouncementBanner to Client Components</name>
  <files>
    src/app/[locale]/_components/Navbar.tsx
    src/app/[locale]/_components/AnnouncementBanner.tsx
    src/app/[locale]/page.tsx
  </files>
  <action>
    **Navbar.tsx — Convert from async Server Component to Client Component:**

    1. Add "use client" directive. Remove `async` keyword. Remove `getTranslations` import.
    2. Accept props: `{ locale, translations }` where:
       - `locale: "es" | "en"`
       - `translations: { about: string; programs: string; community: string; events: string; cta: string }`
    3. Import and use `useScrollDirection` hook from `@/hooks/useScrollDirection`
    4. Apply scroll-based visibility:
       - `scrollDirection === "down"` → add `-translate-y-full` class (hides navbar)
       - `scrollDirection === "up"` or `null` → navbar visible
       - Add `transition-transform duration-300` for smooth animation
    5. Import `hamburger-react` and add mobile hamburger menu:
       - `useState` for `isOpen` state
       - `<Squash toggled={isOpen} toggle={setIsOpen} size={20} />` in the mobile toggle div
       - Mobile menu panel: absolute positioned below navbar, shown when `isOpen`, contains same nav links + SpecHack + language switcher + CTA
       - Add `color="hsl(var(--foreground))"` prop to Squash for theme color
    6. Replace static "ES | EN" text with working language switcher:
       - Import `useRouter` and `usePathname` from `next-intl/client` (if that works) or from `@/i18n/routing` (check next-intl v4 API)
       - Actually, use `Link` from `@/i18n/routing` with `locale` prop for locale switching, or use `useRouter` from `next-intl` — check the next-intl docs pattern for App Router
       - Two buttons: ES and EN. Active locale gets `font-bold text-foreground`, inactive gets `text-muted-foreground`
       - On click: navigate to same page with different locale using `router.replace(pathname, { locale: newLocale, scroll: false })` to preserve scroll position
       - Wrap in the same styled container as the original (font-mono-accent border)
    7. Keep all existing nav link markup, SpecHack badge, and CTA button
    8. Close mobile menu when a nav link is clicked (set `isOpen(false)`)

    **Important next-intl pattern for Client Components:**
    - Import `useRouter` from `@/i18n/routing` (the project's routing config) or from `next-intl`
    - Import `usePathname` from `next-intl` or `@/i18n/routing`
    - Check what `src/i18n/routing.ts` exports — it likely re-exports these from next-intl

    **AnnouncementBanner.tsx — Convert from async Server Component to Client Component:**

    1. Add "use client" directive. Remove `async` keyword. Remove `getTranslations` import.
    2. Accept props: `{ translations }` where:
       - `translations: { text: string; link: string }`
    3. Import and use `useLocalStorage` from `@/hooks/useLocalStorage`
    4. `const [isDismissed, setIsDismissed] = useLocalStorage("404tf:announcement-spechack:dismissed", false)`
    5. If `isDismissed`, return `null`
    6. Add close/dismiss button (X icon from lucide-react) at right side of banner
    7. On dismiss click: `setIsDismissed(true)`
    8. Keep all existing banner markup (gradient-purple background, text, link)

    **page.tsx — Pass locale and translations to Client Components:**

    1. Import `getTranslations` from `next-intl/server` (already imported via components, but now page needs it directly)
    2. Fetch translations for nav and banner:
       ```
       const navT = await getTranslations("landing.nav");
       const bannerT = await getTranslations("landing.banner");
       ```
    3. Pass to components:
       ```
       <AnnouncementBanner translations={{ text: bannerT("text"), link: bannerT("link") }} />
       <Navbar locale={locale as "es" | "en"} translations={{ about: navT("about"), programs: navT("programs"), community: navT("community"), events: navT("events"), cta: navT("cta") }} />
       ```
    4. Cast locale to `"es" | "en"` type (it comes as `string` from params)
  </action>
  <verify>
    - `bunx biome check src/app/[locale]/_components/Navbar.tsx src/app/[locale]/_components/AnnouncementBanner.tsx src/app/[locale]/page.tsx` passes
    - `bunx tsc --noEmit` passes (no type errors)
    - `bun run build` succeeds (no build errors)
    - `bun dev` → visit localhost:3000/es:
      - Navbar visible at top, hides when scrolling down, reappears on scroll up
      - Hamburger icon visible on mobile (resize to < 768px), opens mobile menu
      - Language switcher shows ES/EN, clicking EN navigates to /en
      - Banner visible with dismiss X button, clicking X hides it, refreshing page keeps it hidden
  </verify>
  <done>
    Navbar is a Client Component with scroll-based show/hide, animated hamburger mobile menu, working language switcher (preserves scroll), and all nav links functional. AnnouncementBanner is a Client Component with localStorage-persisted dismiss state. page.tsx passes locale and translations as props. Zero hydration errors.
  </done>
</task>

</tasks>

<verification>
1. `bunx biome check src/` — zero errors across all files
2. `bunx tsc --noEmit` — TypeScript clean
3. `bun run build` — production build succeeds
4. Manual: Visit /es, scroll down (navbar hides), scroll up (navbar shows)
5. Manual: Resize to mobile, tap hamburger (menu opens), tap again (closes)
6. Manual: Click EN in language switcher → navigates to /en, scroll position preserved
7. Manual: Click X on announcement banner → banner disappears, refresh → still gone
8. Browser console: zero hydration errors
</verification>

<success_criteria>
- Navbar shows/hides on scroll with smooth 300ms transition
- Hamburger menu opens/closes on screens < md breakpoint
- Language switcher navigates between /es and /en preserving scroll position
- AnnouncementBanner dismisses on X click and persists via localStorage key "404tf:announcement-spechack:dismissed"
- All components use "use client" directive, no async Server Component patterns
- Zero hydration errors, zero Biome errors, zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-interactive-components/03-01-SUMMARY.md`
</output>
