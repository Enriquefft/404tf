---
phase: 04-seo-metadata
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/app/sitemap.ts
  - src/app/robots.ts
  - src/app/[locale]/opengraph-image.tsx
autonomous: true

must_haves:
  truths:
    - "/sitemap.xml lists both /es and /en with hreflang alternates pointing to each other"
    - "/robots.txt allows all crawlers and links to /sitemap.xml with absolute URL"
    - "/es/opengraph-image returns a PNG image (1200x630) with Spanish branding text"
    - "/en/opengraph-image returns a PNG image (1200x630) with English branding text"
  artifacts:
    - path: "src/app/sitemap.ts"
      provides: "Sitemap with all locale URLs and alternates"
      exports: ["default"]
      contains: "MetadataRoute.Sitemap"
    - path: "src/app/robots.ts"
      provides: "Robots.txt allowing all crawlers"
      exports: ["default"]
      contains: "MetadataRoute.Robots"
    - path: "src/app/[locale]/opengraph-image.tsx"
      provides: "Dynamic OG image per locale"
      exports: ["default", "alt", "size", "contentType"]
      contains: "ImageResponse"
  key_links:
    - from: "src/app/sitemap.ts"
      to: "src/lib/metadata/seo-config.ts"
      via: "import SITE_URL for absolute URLs"
      pattern: "import.*SITE_URL.*seo-config"
    - from: "src/app/robots.ts"
      to: "src/lib/metadata/seo-config.ts"
      via: "import SITE_URL for sitemap link"
      pattern: "import.*SITE_URL.*seo-config"
    - from: "src/app/[locale]/opengraph-image.tsx"
      to: "next-intl/server"
      via: "getTranslations for locale-aware text"
      pattern: "getTranslations.*metadata"
---

<objective>
Add discovery files (sitemap.xml, robots.txt) and dynamic OpenGraph image generation to complete the SEO infrastructure.

Purpose: Enable search engine crawling/indexing via sitemap and robots.txt, and generate locale-specific social sharing preview images for platforms like Twitter, Facebook, LinkedIn, and messaging apps.

Output: /sitemap.xml with locale variants, /robots.txt allowing all crawlers, and /es/opengraph-image + /en/opengraph-image returning branded 1200x630 PNG images.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-seo-a-metadata/04-RESEARCH.md
@.planning/phases/04-seo-a-metadata/04-01-SUMMARY.md
@src/lib/metadata/seo-config.ts
@src/styles/fonts.ts
@src/app/[locale]/layout.tsx
@messages/es.json
@messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Sitemap and robots.txt generation</name>
  <files>
    src/app/sitemap.ts
    src/app/robots.ts
  </files>
  <action>
    1. Create `src/app/sitemap.ts` (SEO-06):
       - Import SITE_URL from "@/lib/metadata/seo-config"
       - Export default function returning `MetadataRoute.Sitemap`
       - List two entries: one for /es, one for /en
       - Each entry has: url (absolute), lastModified (new Date()), changeFrequency "weekly", priority 1
       - Each entry has alternates.languages with both es and en absolute URLs
       - Pattern from research:
         ```typescript
         import type { MetadataRoute } from "next";
         import { SITE_URL } from "@/lib/metadata/seo-config";

         export default function sitemap(): MetadataRoute.Sitemap {
           return [
             {
               url: `${SITE_URL}/es`,
               lastModified: new Date(),
               changeFrequency: "weekly",
               priority: 1,
               alternates: {
                 languages: {
                   es: `${SITE_URL}/es`,
                   en: `${SITE_URL}/en`,
                 },
               },
             },
             {
               url: `${SITE_URL}/en`,
               lastModified: new Date(),
               changeFrequency: "weekly",
               priority: 1,
               alternates: {
                 languages: {
                   es: `${SITE_URL}/es`,
                   en: `${SITE_URL}/en`,
                 },
               },
             },
           ];
         }
         ```

    2. Create `src/app/robots.ts` (SEO-07):
       - Import SITE_URL from "@/lib/metadata/seo-config"
       - Export default function returning `MetadataRoute.Robots`
       - Allow all user agents, allow "/" root path
       - Link to sitemap at `${SITE_URL}/sitemap.xml`
       - Pattern from research:
         ```typescript
         import type { MetadataRoute } from "next";
         import { SITE_URL } from "@/lib/metadata/seo-config";

         export default function robots(): MetadataRoute.Robots {
           return {
             rules: {
               userAgent: "*",
               allow: "/",
             },
             sitemap: `${SITE_URL}/sitemap.xml`,
           };
         }
         ```

    Use Biome formatting: tabs, double quotes. These are root-level app files (NOT inside [locale]).
  </action>
  <verify>
    - `bun run check` passes
    - `bun dev` starts without errors
    - `curl -s http://localhost:3000/sitemap.xml` returns valid XML with /es and /en entries and xhtml:link alternates
    - `curl -s http://localhost:3000/robots.txt` returns "User-agent: *\nAllow: /\n" with Sitemap line pointing to absolute URL
  </verify>
  <done>
    - /sitemap.xml lists /es and /en with lastmod, changefreq weekly, priority 1, and hreflang alternates
    - /robots.txt allows all crawlers and references /sitemap.xml with absolute SITE_URL
    - Both files use SITE_URL from seo-config.ts (single source of truth)
  </done>
</task>

<task type="auto">
  <name>Task 2: Dynamic OpenGraph image generation per locale</name>
  <files>
    src/app/[locale]/opengraph-image.tsx
  </files>
  <action>
    Create `src/app/[locale]/opengraph-image.tsx` (SEO-05) using Next.js file-based metadata convention.

    This file auto-registers as the OG image for routes under [locale]. When a crawler or social platform requests /es/opengraph-image or /en/opengraph-image, it generates a PNG.

    CRITICAL: Cannot use next/font/google imports here -- ImageResponse runs in edge-like runtime where next/font is unavailable. Must fetch font data via URL.

    Export required metadata:
    ```typescript
    export const alt = "404 Tech Found";
    export const size = { width: 1200, height: 630 };
    export const contentType = "image/png";
    ```

    Export default async function:
    ```typescript
    import { ImageResponse } from "next/og";
    import { getTranslations } from "next-intl/server";

    export const alt = "404 Tech Found";
    export const size = { width: 1200, height: 630 };
    export const contentType = "image/png";

    export default async function Image({
      params,
    }: {
      params: Promise<{ locale: string }>;
    }) {
      const { locale } = await params;
      const t = await getTranslations({ locale, namespace: "metadata" });

      // Fetch Orbitron font for brand consistency (cannot use next/font here)
      const orbitronBold = await fetch(
        new URL("https://fonts.gstatic.com/s/orbitron/v31/yMJRMIlzdpvBhQQL_Qq7dy0.woff2")
      ).then((res) => res.arrayBuffer());

      const interRegular = await fetch(
        new URL("https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuLyfAZ9hiA.woff2")
      ).then((res) => res.arrayBuffer());

      return new ImageResponse(
        (
          <div
            style={{
              height: "100%",
              width: "100%",
              display: "flex",
              flexDirection: "column",
              alignItems: "center",
              justifyContent: "center",
              background: "linear-gradient(135deg, #0a0014 0%, #1a0033 50%, #0a0a2e 100%)",
              padding: "60px",
            }}
          >
            {/* Purple glow accent */}
            <div
              style={{
                position: "absolute",
                top: "50%",
                left: "50%",
                transform: "translate(-50%, -50%)",
                width: "600px",
                height: "600px",
                borderRadius: "50%",
                background: "radial-gradient(circle, rgba(139, 92, 246, 0.15) 0%, transparent 70%)",
                display: "flex",
              }}
            />
            {/* Site name */}
            <div
              style={{
                fontSize: 28,
                fontFamily: "Orbitron",
                fontWeight: 700,
                color: "#a78bfa",
                letterSpacing: "4px",
                marginBottom: "24px",
                display: "flex",
              }}
            >
              404 TECH FOUND
            </div>
            {/* Title */}
            <div
              style={{
                fontSize: 48,
                fontFamily: "Orbitron",
                fontWeight: 700,
                color: "white",
                textAlign: "center",
                lineHeight: 1.2,
                maxWidth: "900px",
                display: "flex",
              }}
            >
              {t("title")}
            </div>
            {/* Tagline */}
            <div
              style={{
                fontSize: 24,
                fontFamily: "Inter",
                color: "#a1a1aa",
                marginTop: "24px",
                textAlign: "center",
                maxWidth: "700px",
                display: "flex",
              }}
            >
              {t("tagline")}
            </div>
            {/* House color bar at bottom */}
            <div
              style={{
                position: "absolute",
                bottom: 0,
                left: 0,
                right: 0,
                height: "6px",
                display: "flex",
                flexDirection: "row",
              }}
            >
              <div style={{ flex: 1, background: "#ec4899", display: "flex" }} />
              <div style={{ flex: 1, background: "#22c55e", display: "flex" }} />
              <div style={{ flex: 1, background: "#f97316", display: "flex" }} />
            </div>
          </div>
        ),
        {
          ...size,
          fonts: [
            {
              name: "Orbitron",
              data: orbitronBold,
              style: "normal",
              weight: 700,
            },
            {
              name: "Inter",
              data: interRegular,
              style: "normal",
              weight: 400,
            },
          ],
        }
      );
    }
    ```

    Design notes:
    - Dark purple gradient background matching cyberpunk theme
    - Orbitron font for "404 TECH FOUND" header and title (brand font)
    - Inter for tagline (body font)
    - Purple radial glow effect for visual depth
    - House color bar at bottom (AI pink #ec4899, Biotech green #22c55e, Hardware orange #f97316)
    - Locale-specific title and tagline from translations
    - 1200x630 standard OG image size

    IMPORTANT: The Google Fonts URLs above are examples. If they fail at runtime, use the Google Fonts CSS API to discover the actual woff2 URL:
    - Fetch `https://fonts.googleapis.com/css2?family=Orbitron:wght@700` with a browser-like User-Agent
    - Extract the woff2 URL from the CSS response
    - If font fetching fails, gracefully fall back by removing the fonts array (uses default sans-serif)

    NOTE: Every `<div>` in ImageResponse MUST have `display: "flex"` set explicitly. The Satori renderer (used by ImageResponse) requires this.
  </action>
  <verify>
    - `bun run check` passes
    - `bun dev` starts without errors
    - Visit `http://localhost:3000/es/opengraph-image` in browser -- shows a 1200x630 PNG with Spanish title text, purple gradient background, and house color bar
    - Visit `http://localhost:3000/en/opengraph-image` in browser -- shows a 1200x630 PNG with English title text
    - Check response headers: Content-Type should be image/png
    - `bun run build` succeeds (catches 500KB bundle limit issues)
  </verify>
  <done>
    - /es/opengraph-image returns 1200x630 PNG with Spanish branding (title, tagline in Spanish)
    - /en/opengraph-image returns 1200x630 PNG with English branding (title, tagline in English)
    - Images feature cyberpunk purple gradient, Orbitron font, house color bar
    - Content-Type is image/png, dimensions are 1200x630
    - Build succeeds without bundle size errors
  </done>
</task>

</tasks>

<verification>
1. `bun run check` passes with zero errors
2. `bun run build` succeeds without errors (critical for OG image bundle size check)
3. `curl -s http://localhost:3000/sitemap.xml` returns valid XML with /es and /en entries
4. `curl -s http://localhost:3000/robots.txt` returns proper rules with sitemap link
5. `curl -I http://localhost:3000/es/opengraph-image` returns Content-Type: image/png
6. `curl -I http://localhost:3000/en/opengraph-image` returns Content-Type: image/png
7. Visiting /es/opengraph-image and /en/opengraph-image in browser shows distinct locale-specific images
</verification>

<success_criteria>
- SEO-05: /es/opengraph-image and /en/opengraph-image return locale-specific 1200x630 PNG images
- SEO-06: /sitemap.xml lists /es and /en with hreflang alternates
- SEO-07: /robots.txt allows all crawlers and links to sitemap
- All SEO requirements (SEO-01 through SEO-08) are fully satisfied across both plans
</success_criteria>

<output>
After completion, create `.planning/phases/04-seo-a-metadata/04-02-SUMMARY.md`
</output>
