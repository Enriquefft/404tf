---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - biome.jsonc
  - lefthook.yml
  - .lefthook/commit-msg/commitlint.sh
  - .lefthook/commit-msg/.commitlintrc.yaml
  - knip.config.ts
  - bunfig.toml
  - .gitignore
  - .env.example
autonomous: true

must_haves:
  truths:
    - "Running `bun install` succeeds with zero errors and all dependencies resolve"
    - "Running `bun run check` (Biome) passes with zero errors on existing files"
    - "Running `bunx lefthook run pre-commit` executes lint and type-check commands"
    - "TypeScript compilation (`bunx tsc --noEmit`) succeeds with zero errors"
  artifacts:
    - path: "package.json"
      provides: "All project dependencies and scripts"
      contains: "next"
    - path: "tsconfig.json"
      provides: "TypeScript configuration with path aliases"
      contains: "@/*"
    - path: "next.config.ts"
      provides: "Next.js 16 configuration with next-intl plugin and env validation import"
      contains: "withNextIntl"
    - path: "biome.jsonc"
      provides: "Linting and formatting rules for Next.js App Router"
      contains: "next"
    - path: "lefthook.yml"
      provides: "Git hook configuration for pre-commit and commit-msg"
      contains: "pre-commit"
    - path: "knip.config.ts"
      provides: "Dead code detection configuration"
      contains: "entry"
    - path: "bunfig.toml"
      provides: "Bun test runner configuration"
      contains: "[test]"
  key_links:
    - from: "next.config.ts"
      to: "next-intl/plugin"
      via: "createNextIntlPlugin import"
      pattern: "createNextIntlPlugin"
    - from: "next.config.ts"
      to: "src/env/client"
      via: "side-effect import for build-time validation"
      pattern: "import.*env/client"
    - from: "tsconfig.json"
      to: "src/*"
      via: "path alias @/*"
      pattern: "@/\\*.*src/\\*"
---

<objective>
Initialize the Next.js 16 project with Bun, install all Phase 1 dependencies, configure TypeScript, create the Next.js config with next-intl and env validation wiring, and set up all developer tooling (Biome, Lefthook, commitlint, Knip, bunfig.toml).

Purpose: This is the foundation that every other plan in Phase 1 (and all subsequent phases) depends on. Package installation and build tooling must be rock-solid before adding styling, i18n, or database concerns.
Output: A working Next.js 16 project skeleton that builds, lints, and has git hooks configured.
</objective>

<execution_context>
@/home/hybridz/.claude/get-shit-done/workflows/execute-plan.md
@/home/hybridz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/hybridz/Projects/404tf/.planning/PROJECT.md
@/home/hybridz/Projects/404tf/.planning/ROADMAP.md
@/home/hybridz/Projects/404tf/.planning/REQUIREMENTS.md
@/home/hybridz/Projects/404tf/.planning/phases/01-foundation/01-RESEARCH.md
@/home/hybridz/Projects/404tf/flake.nix

Reference (read-only, for config patterns):
@/home/hybridz/Projects/next-fullstack-template/package.json
@/home/hybridz/Projects/next-fullstack-template/tsconfig.json
@/home/hybridz/Projects/next-fullstack-template/next.config.ts
@/home/hybridz/Projects/next-fullstack-template/biome.jsonc
@/home/hybridz/Projects/next-fullstack-template/lefthook.yml
@/home/hybridz/Projects/next-fullstack-template/knip.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js 16 project with all dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    src/lib/utils.ts
    .gitignore
    .env.example
  </files>
  <action>
Create the Next.js 16 project from scratch (do NOT use `create-next-app` -- we need precise control over dependencies and config).

1. Create `package.json` with these exact sections:
   - name: "404tf"
   - private: true
   - type: "module"
   - scripts:
     - "dev": "next dev --turbopack"
     - "build": "next build"
     - "start": "next start"
     - "lint": "biome check --fix ."
     - "check": "biome check ."
     - "check:deps": "knip"
     - "db:generate": "drizzle-kit generate"
     - "db:push": "drizzle-kit push"
     - "db:studio": "drizzle-kit studio"
   - dependencies:
     - next@latest
     - react@latest
     - react-dom@latest
     - next-intl@latest
     - drizzle-orm (latest)
     - @neondatabase/serverless (latest)
     - @t3-oss/env-nextjs (latest)
     - zod (latest)
     - clsx (latest)
     - tailwind-merge (latest)
   - devDependencies:
     - typescript (latest)
     - @types/node (latest)
     - @types/react (latest)
     - @types/react-dom (latest)
     - tailwindcss@~4.0.0 (IMPORTANT: use ~4.0.0 range to avoid v4.1.18 Turbopack bug)
     - @tailwindcss/postcss (latest)
     - postcss (latest)
     - @biomejs/biome (latest)
     - drizzle-kit (latest)
     - knip (latest)

2. Run `bun install` to install all dependencies.

3. Create `tsconfig.json`:
   - Use reference template pattern
   - Set `compilerOptions.paths`: `{ "@/*": ["./src/*"] }`
   - Set `compilerOptions.target`: "ESNext"
   - Set `compilerOptions.module`: "ESNext"
   - Set `compilerOptions.moduleResolution`: "bundler"
   - Set `compilerOptions.jsx`: "preserve"
   - Set `compilerOptions.strict`: true
   - Set `compilerOptions.esModuleInterop`: true
   - Set `compilerOptions.skipLibCheck`: true
   - Set `compilerOptions.forceConsistentCasingInFileNames`: true
   - Set `compilerOptions.noEmit`: true
   - Set `compilerOptions.incremental`: true
   - Set `compilerOptions.resolveJsonModule`: true
   - Set `compilerOptions.isolatedModules`: true
   - Set `compilerOptions.plugins`: [{ "name": "next" }]
   - Set `compilerOptions.lib`: ["dom", "dom.iterable", "esnext"]
   - Set `compilerOptions.allowJs`: true
   - Set `include`: ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"]
   - Set `exclude`: ["node_modules"]

4. Create `next.config.ts` with the FINAL configuration (both next-intl plugin AND env import):
   ```typescript
   import createNextIntlPlugin from "next-intl/plugin";
   import type { NextConfig } from "next";

   // Validate environment variables at build time
   // NOTE: env files created in Plan 01-03. This import is safe --
   // Next.js only evaluates next.config.ts during build/dev start.
   await import("./src/env/client.js");

   const withNextIntl = createNextIntlPlugin();

   const nextConfig: NextConfig = {
     images: {
       formats: ["image/avif", "image/webp"],
     },
     transpilePackages: ["@t3-oss/env-nextjs", "@t3-oss/env-core"],
   };

   export default withNextIntl(nextConfig);
   ```
   NOTE: The `await import("./src/env/client.js")` will fail until Plan 01-03 creates `src/env/client.ts`. This is expected -- `bun dev` will not be runnable until both Wave 2 plans complete. The build system (package installation, TypeScript, Biome) works independently.

5. Create `src/lib/utils.ts` (shadcn/ui utility required by all components):
   ```typescript
   import { type ClassValue, clsx } from "clsx";
   import { twMerge } from "tailwind-merge";

   export function cn(...inputs: ClassValue[]) {
     return twMerge(clsx(inputs));
   }
   ```

6. Create `.gitignore` with standard Next.js entries:
   - node_modules, .next, out, .env*.local (not .env.example), *.tsbuildinfo, next-env.d.ts

7. Create `.env.example` documenting all required environment variables:
   ```
   # Database (Neon serverless Postgres)
   DATABASE_URL=postgresql://user:password@host/database?sslmode=require

   # PostHog Analytics (Phase 5 -- leave empty for now)
   NEXT_PUBLIC_POSTHOG_KEY=
   NEXT_PUBLIC_POSTHOG_HOST=
   ```

IMPORTANT: Do NOT install lefthook or commitlint via bun. They are provided at the system level via Nix devShell (see flake.nix: `lefthook` and `commitlint-rs`). Only install npm packages that are runtime or dev dependencies of the Next.js project itself.
  </action>
  <verify>
    Run `bun install` exits with code 0.
    Run `bunx tsc --noEmit` (may show errors about missing files referenced in next.config.ts -- that is expected and acceptable for this task).
    Verify `node_modules/.package-lock.json` or `bun.lockb` exists.
    Verify `package.json` contains "next", "react", "tailwindcss", "drizzle-orm", "@biomejs/biome".
  </verify>
  <done>
    package.json exists with all Phase 1 dependencies listed. `bun install` succeeds. tsconfig.json has path aliases configured. next.config.ts has withNextIntl wrapper and env import. .gitignore covers Next.js artifacts. .env.example documents required env vars.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure developer tooling (Biome, Lefthook, commitlint, Knip, bunfig)</name>
  <files>
    biome.jsonc
    lefthook.yml
    .lefthook/commit-msg/commitlint.sh
    .lefthook/commit-msg/.commitlintrc.yaml
    knip.config.ts
    bunfig.toml
  </files>
  <action>
1. Create `biome.jsonc` following the research Pattern 7 exactly:
   - Schema: "https://biomejs.dev/schemas/2.3.10/schema.json"
   - formatter.enabled: true, formatter.indentStyle: "tab"
   - javascript.formatter.quoteStyle: "double"
   - linter.enabled: true
   - linter.domains: { "next": "all", "react": "all" }
   - linter.rules.recommended: true
   - linter.rules.complexity.useLiteralKeys: "off"
   - linter.includes: ["**"]
   - linter.excludes: ["**/node_modules", "**/.next", "**/src/components/ui/*"]
   - overrides for App Router files (page.tsx, layout.tsx, error.tsx, not-found.tsx, proxy.ts):
     - style.noDefaultExport: "off"
     - style.useComponentExportOnlyModules with allowExportNames: ["metadata", "generateMetadata", "generateStaticParams", "config"]
   - css.parser: { cssModules: true, tailwindDirectives: true }
   - css.formatter.enabled: true

2. Create `lefthook.yml` following research Pattern 8:
   - commit-msg: scripts: "commitlint.sh" with runner: bash
   - pre-commit: parallel: true, commands:
     - lint: glob "*.{js,ts,jsx,tsx,json,jsonc}", run: `bun lint --no-errors-on-unmatched --files-ignore-unknown=true {staged_files}`
     - types: glob "*.{js,ts,jsx,tsx}", run: `bunx tsc --noEmit`

3. Create `.lefthook/commit-msg/commitlint.sh`:
   ```bash
   #!/bin/bash
   commitlint --edit "$1"
   ```
   NOTE: Using commitlint-rs from Nix (system-level), not @commitlint/cli. The commitlint-rs binary uses `--edit` flag to read the commit message file.

4. Create `.lefthook/commit-msg/.commitlintrc.yaml`:
   ```yaml
   rules:
     type-empty:
       level: error
     subject-empty:
       level: error
     type:
       level: error
       options:
         - build
         - chore
         - ci
         - docs
         - feat
         - fix
         - perf
         - refactor
         - revert
         - style
         - test
   ```

5. Make commitlint.sh executable: `chmod +x .lefthook/commit-msg/commitlint.sh`

6. Run `lefthook install` to activate git hooks (lefthook is available from Nix devShell, not npm).

7. Create `knip.config.ts` following research Pattern 9:
   ```typescript
   import type { KnipConfig } from "knip";

   const config: KnipConfig = {
     entry: [
       "src/app/**/*",
       "src/env/**/*",
       "src/i18n/request.ts",
     ],
     ignore: [
       "src/components/ui/**/*",
     ],
     ignoreDependencies: [],
     paths: {
       "@/*": ["./src/*"],
     },
     compilers: {
       css: (text: string) => [...text.matchAll(/(?<=@)import[^;]+/g)].join("\n"),
     },
   };

   export default config;
   ```

8. Create `bunfig.toml`:
   ```toml
   [test]
   preload = []
   timeout = 30000
   ```
  </action>
  <verify>
    Run `bun run check` (Biome check) -- should pass with zero errors on existing files (package.json, tsconfig.json, biome.jsonc, etc.).
    Run `lefthook run pre-commit` -- should execute without crashing (may show warnings about no staged files, that is fine).
    Verify `.lefthook/commit-msg/commitlint.sh` is executable (`test -x .lefthook/commit-msg/commitlint.sh`).
    Verify `knip.config.ts` and `bunfig.toml` exist and are valid.
  </verify>
  <done>
    Biome lints and formats the codebase with zero errors. Lefthook git hooks are installed and run on pre-commit (lint + type-check) and commit-msg (commitlint). Knip is configured for dead code detection. Bun test runner has a 30s timeout configured.
  </done>
</task>

</tasks>

<verification>
1. `bun install` exits cleanly
2. `bun run check` passes with zero errors
3. `bunx tsc --noEmit` runs (errors about missing src/env/client.ts and src/i18n files are expected -- those are created in Wave 2 plans)
4. `lefthook run pre-commit` executes lint command
5. Files exist: package.json, tsconfig.json, next.config.ts, biome.jsonc, lefthook.yml, knip.config.ts, bunfig.toml, .gitignore, .env.example
</verification>

<success_criteria>
- All Phase 1 npm dependencies installed via `bun install`
- TypeScript configured with `@/*` path alias
- next.config.ts has withNextIntl wrapper and env import (ready for Wave 2 plans to populate)
- Biome passes with zero errors
- Lefthook hooks installed (pre-commit: lint + types, commit-msg: commitlint)
- Knip configured for Next.js App Router entry points
- Bun test configuration set
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
